AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: An AWS Serverless Specification template describing your function.
Resources:

  Table:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: books
      BillingMode: PAY_PER_REQUEST
      KeySchema:
        - AttributeName: author
          KeyType: HASH
        - AttributeName: title
          KeyType: RANGE
      AttributeDefinitions:
        - AttributeName: author
          AttributeType: S
        - AttributeName: title
          AttributeType: S
        - AttributeName: genre
          AttributeType: S
        - AttributeName: publication_date
          AttributeType: S
      LocalSecondaryIndexes:
        - IndexName: author-genre
          KeySchema:
            - AttributeName: author
              KeyType: HASH
            - AttributeName: genre
              KeyType: RANGE
          Projection:
            ProjectionType: ALL
      GlobalSecondaryIndexes:
        - IndexName: genre-publication
          KeySchema:
            - AttributeName: genre
              KeyType: HASH
            - AttributeName: publication_date
              KeyType: RANGE
          Projection:
            ProjectionType: ALL

  CreateBookFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub 'bookshelf-create-book-fct'
      Handler: src.bookshelf.handler.create_book
      Runtime: python3.7

  DeleteBookFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: !Sub 'bookshelf-delete-book-fct'
      Handler: src.bookshelf.handler.delete_book
      Runtime: python3.7